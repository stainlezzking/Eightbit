<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Now</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="shortcut icon" href="static/images/favicon.png" type="image/x-icon">
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <style>
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .message_warning {
            border-radius: 5px;
            font-size: .8rem;
            color: white;
            margin-top: 6rem;
        }
        .container{
            max-width: 600px;
            background:rgba(245, 245, 245, 0.34);
            box-shadow: 2px 2px 10px 0px black;
            position: relative;
        }
        .brand{
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
    /*  editing the int-styles a little */
        .iti {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .iti--allow-dropdown input, .iti--allow-dropdown input[type=text], .iti--allow-dropdown input[type=tel], .iti--separate-dial-code input, .iti--separate-dial-code input[type=text], .iti--separate-dial-code input[type=tel] {
            padding: .7rem 0;
            padding-right: 6px;
            padding-left: 52px;
        }
        /* #### background_animation ###### */
        
.area{
    background: blue;  
    background: -webkit-linear-gradient(to left, #8f94fb, #4e54c8);  
    width: 100%;
    height:100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -10;
   
}

.circles{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.circles li{
    position: absolute;
    display: block;
    list-style: none;
    width: 20px;
    height: 20px;
    background: rgba(255, 255, 255, 0.2);
    animation: animate 25s linear infinite;
    bottom: -150px;
    
}

.circles li:nth-child(1){
    left: 25%;
    width: 80px;
    height: 80px;
    animation-delay: 0s;
}


.circles li:nth-child(2){
    left: 10%;
    width: 20px;
    height: 20px;
    animation-delay: 2s;
    animation-duration: 12s;
}

.circles li:nth-child(3){
    left: 70%;
    width: 20px;
    height: 20px;
    animation-delay: 4s;
}

.circles li:nth-child(4){
    left: 40%;
    width: 60px;
    height: 60px;
    animation-delay: 0s;
    animation-duration: 18s;
}

.circles li:nth-child(5){
    left: 65%;
    width: 20px;
    height: 20px;
    animation-delay: 0s;
}

.circles li:nth-child(6){
    left: 75%;
    width: 110px;
    height: 110px;
    animation-delay: 3s;
}

.circles li:nth-child(7){
    left: 35%;
    width: 150px;
    height: 150px;
    animation-delay: 7s;
}

.circles li:nth-child(8){
    left: 50%;
    width: 25px;
    height: 25px;
    animation-delay: 15s;
    animation-duration: 45s;
}

.circles li:nth-child(9){
    left: 20%;
    width: 15px;
    height: 15px;
    animation-delay: 2s;
    animation-duration: 35s;
}

.circles li:nth-child(10){
    left: 85%;
    width: 150px;
    height: 150px;
    animation-delay: 0s;
    animation-duration: 11s;
}



@keyframes animate {

    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 0;
    }

    100%{
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
        border-radius: 50%;
    }

}

    </style>
</head>
<body>
   <% if(messages.error){ %>
        <div class="modal fade show" style="display: block;" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">
                       Create an Account
                    </h5>
                  <button type="button" class="btn-close text-warning"  style="border:none;" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times " ></i>
                  </button>
                </div>
                <div class="modal-body">
                <%= messages.error %>
                </div>
              </div>
            </div>
          </div>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
          <script>
            var myModal = new bootstrap.Modal(document.getElementById('exampleModal'))
            myModal.show()
        </script>
        
  <%  }else{ %>
        <%- include("profile/partials/modal.ejs") -%>

 <%   } %>
    <div class="area" >
        <ul class="circles">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
        </ul>
</div >
    <div class="container py-4 px-sm-4">
        <div class="brand bg-light">
            <h2 class="display-5 text-success fw-bold text-center py-3">
               <a href="/"> <img style="width: 40px;" src="static/images/favicon.png" alt="Eight-bit investment logo and a link back to home page" srcset=""> </a>Create a Free Account </h2>
        </div>
        <div class="message_warning  bg-info p-2 mb-3"> please ensure that all details are correct, as they will be used in payments during withdrawals </div>
        <form action="/register" method="POST" class="forms">
            <div class="form-group form-floating mb-3">
                <input type="email" name="email" id="email" class="form-control" placeholder="Your Email">
                <label for="email"> Your Email</label>
            </div>
            <div class="form-group form-floating mb-3">
                <input type="text" name="name" id="fullName" class="form-control" placeholder="Your Full Name">
                <label for="fullName"> Your Full Name</label>
            </div>
            <div class="form-group form-floating mb-3">
                <input type="text" name="username" id="username" class="form-control" placeholder="Your username">
                <label for="username"> username</label>
            </div>
            <div class="form-group form-floating mb-3">
                <input type="password" name="password" class="form-control" id="floatingPassword" placeholder="Password">
                <label for="floatingPassword">Password</label>
              </div>
              <div class="form-group mb-3">
                  <%- include("partials/selectCountry.ejs") -%>
              </div>
              <div class=" mb-3">
                <input type="tel" name="phoneNumber" id="cell" class="form-control" autocomplete="new-password" placeholder="phone number">
              </div>
              <div class="form-group form-floating mb-3">
                <input type="text" name="walletAddress" id="WA" class="form-control" placeholder="BTC ADDRESS">
                <label for="WA"> BTC ADDRESS</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" name="referralAccount" id="referrals" class="form-control" placeholder="Your referral's Id (optional)">
                <label for="referrals"> REFERRAL ID (optional) </label>
            </div>
            <div class="form-floating  more">
                <input type="hidden" name="ip" id="ip" >
                <input type="hidden" name="loc" id="loc" >
                <input type="hidden" name="sim" id="sim" >
                <input type="hidden" name="city" id="city" >
                <input type="hidden" name="ipCountry" id="ipCountry" >
            </div>
            <button type="submit" class="btn btn-info btn-md d-block mx-auto my-4"> REGISTER</button>
            <div class="py-3 text-end fw-bold" style="font-size: .7rem;"> have an account with us ? <a href="/login">Login</a></div>
        </form>
    </div>

   <script>

   const phoneInputField = document.querySelector("#cell");
   var ipResp ;
//    Automate COUNTRY's Location
   function automateCountry(country){
       document.querySelectorAll("#country option").forEach(option=>{
           if(option.getAttribute("data-target") === country){
            document.querySelector("#country option").removeAttribute("selected")
               option.setAttribute("selected","")
           }
       })
   }
//  Function  than connects to my ipinfo account that automates country's flag in input
   function getIp(callback) {
    fetch('https://ipinfo.io/json?token=4abe8bc3e4294d', { headers: { 'Accept': 'application/json' }})
        .then((resp) => resp.json())
        .catch((err) => {
            return {
            country: 'us',
            };
            console.log(err)
        })
        .then((resp) =>{ 
            ipResp = resp
            automateCountry(resp.country)
           return callback(resp.country)
        });
    }


   const phoneInput = window.intlTelInput(phoneInputField, {
    initialCountry: "auto",
    geoIpLookup: getIp,
     utilsScript:
       "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
   });

//     Modal initializaation
if(!"<%= messages.error %>"){
    var myModal = new bootstrap.Modal(document.getElementById('exampleModal'))
}
  


//    validation
document.querySelector("form").addEventListener("submit", function(event){
        event.preventDefault()
        var pass = true
        var message = "Make sure all inputs are filled"
        var title = "Fill all inputs"
            
            document.querySelector(".more #ip").value = ipResp.ip
            document.querySelector(".more #city").value = ipResp.city
            document.querySelector(".more #loc").value = ipResp.loc
            document.querySelector(".more #sim").value = ipResp.org
            document.querySelector(".more #ipCountry").value = ipResp.country

        if(!Number(document.querySelector("#cell").value)){
                document.querySelector('.modal-body').innerText = "check your phone number and try again"
                document.querySelector('.modal-title').innerText = title
                return myModal.show()
         }

         var inputs = Array.from(document.querySelectorAll(".form-group input"))
        inputs.push(document.querySelector("select"))
        inputs.forEach(input=>{
            if(!input.value.trim()){
                var message = "Make sure all inputs are filled"
                document.querySelector('.modal-body').innerText = message
                document.querySelector('.modal-title').innerText = title
                 myModal.show()
                return pass = false
            }
        })

        // console.log(phoneInput.getNumber()) this gives the countrys formating
        if(pass){
         document.querySelector("#cell").value = phoneInput.getNumber() 
         this.submit()
                // the forEach return statement doent return the whole fxn
        }
    })
   </script>
</body>
</html>